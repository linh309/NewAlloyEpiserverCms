@model PluginCommentViewModel
@{
    Layout = "~/Views/Shared/Layouts/_Plugin.cshtml";
    ViewBag.Title = "Manager user comments";
}

<div class="hide" id="centered">
    <p>Successfully</p>
</div>

<div class="row">
    <div class="span12 heading-top-comment">
        <h2>
            Manage comment
        </h2>
        <hr class="break-comment" />
    </div>
</div>

<div class="row margin-bottom-0">
    @Html.HiddenFor(x => x.SelectedPagedId)
    @Html.Hidden("hdnUrlGetData", Url.Action("LoadComment"))
    @Html.Hidden("hdnUrlUpdateComment", Url.Action("UpdateComment"))
    <div class="span2"></div>
    <div class="span10 margin-bottom-0">
        <input type="checkbox" id="chkDeletedComment" /><label for="chkDeletedComment"> Show deleted comment</label>
    </div>
</div>

<div class="row">
    <div class="span2">
        @Html.Partial("_ListPages", Model)
    </div>
    <div class="span10" id="listComment">
        @Html.Partial("_ListComment", Model.ListComment)
    </div>
</div>

<script language="javascript">
    $(function () {
        $(document).on("click", ".page-menu-link", onSelectedPage);
        $(document).on("click", ".btn-action", doAction);
        $(document).on("change", "#chkDeletedComment", loadComment);
    })

    function onSelectedPage(btn) {
        var $btnMenu = $(btn.currentTarget);
        var pageId = $btnMenu.data("pageid");
        $("li.plugin-comment-page-menu-item").removeClass("active");
        $("#SelectedPagedId").val(pageId);
        $btnMenu.parent().addClass("active");
        loadComment();
    }

    function loadComment() {
        var urlGetData = $("#hdnUrlGetData").val();
        var isDeleted = $("#chkDeletedComment").prop("checked");
        var pageId = $("#SelectedPagedId").val();

        $.get(urlGetData, { pageId, isDeleted }, function (result) {
            $("#listComment").html(result);
        });
    }

    function doAction(btn) {
        var $actionBtn = $(btn.currentTarget);
        var action = $actionBtn.data("actiontype");
        var confirmMsg = action == "Deleted" ? "Do you want to delete this comment?" : "Do you want to restore this comment?";

        if (confirm(confirmMsg)) {
            var commentId = $actionBtn.data("id");
            var urlUpdate = $("#hdnUrlUpdateComment").val();

            $.post(urlUpdate, { commentId, action }, function (result) {
                if (result.status === 'ok') {
                    $("#centered").fadeIn(100, "swing", function () { $("#centered").fadeOut(500, "swing") });
                    loadComment();
                }
                else if (result.status == 'error') {
                    alert("Comment not found ")
                }
            });
        }
    }

</script>